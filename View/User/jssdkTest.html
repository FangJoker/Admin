<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<link rel="stylesheet" href="">
	<script scr="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" type="text/javascript"></script>
	<import type='js' file="Js.jquery" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<body>
	<button id="chooseImage">IMG</button><br>
	<!-- <button id="previewImage">previewImage</button><br> -->
	<form action="{:U('Admin/User/getWecat','','')}" method="post" id='post' enctype="multipart/form-data">	
	<input type="submit" value="提交">
	</form>
	
<!-- 	<button id="downloadImage">downloadImage</button><br> -->
</body>
<script type="text/javascript">
    define = null;
    require = null;
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" type="text/javascript">
</script>
<script>
	wx.config({
	    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
	    appId: '{$data.appId}', // 必填，公众号的唯一标识
	    timestamp:{$data.time}, // 必填，生成签名的时间戳
	    nonceStr: '{$data.nonceStr}', // 必填，生成签名的随机串
	    signature: '{$data.signature}',// 必填，签名，见附录1
	    jsApiList: ['chooseImage',  
      				'previewImage',  
     				'uploadImage',  
      				'downloadImage', 
      				] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
	});
	wx.ready(function(){
    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
	});




		// 5.1 拍照、本地选图
		$('#chooseImage').click(function () {
		var imgs=new Array();
		// var imgNum=$('.pic img').size();
		// var chooseNum=3-imgNum;
		 wx.chooseImage({
		 	// count: chooseNum,
	      	success: function (res) {
		        imgs= res.localIds;
		        for (var i = 0; i < imgs.length; i++) {
		        	// $('#chooseImage').eq(i+imgNum).html('< img src="'+imgs[i]+'">');
		        	wx.uploadImage({
				        localId: imgs[i],
				        success: function (res) {
	        				$('form').append('<input type="hidden" name="media_id[]" value="'+res.serverId+'">');
				        }
			      });
		        }
	      	}
	    });
	});
		// var images = {
		//     localId: [],
		//     serverId: []
		//   };
		//   $('chooseImage').onclick = function () {
		//     wx.chooseImage({
		//       success: function (res) {
		//         images.localId = res.localIds;
		//         alert('已选择 ' + res.localIds.length + ' 张图片');
		//       }
		//     });
		//   };

		// 5.3 上传图片
			// document.querySelector('#uploadImage').onclick = function () {
			// 	    if (images.localId.length == 0) {
			// 	      alert('请先使用 chooseImage 接口选择图片');
			// 	      return;
			// 	    }
			// 	    var i = 0, length = images.localId.length;
			// 	    images.serverId = [];
			// 	    function upload() {
			// 	      wx.uploadImage({
			// 	        localId: images.localId[i],
			// 	        success: function (res) {
			// 	          i++;
			// 	          //alert('已上传：' + i + '/' + length);
			// 	          images.serverId.push(res.serverId);
			// 	          if (i < length) {
			// 	            upload();
			// 	          }
			// 	         getForm();
			// 	        },
			// 	        fail: function (res) {
			// 	          alert(JSON.stringify(res));
			// 	        }

			// 	      });

			// 	    }
			// 	    upload();
				   	
			// 	  };
			//   	 function getForm(){
			//   	var i = 0, length = images.serverId.length;
			//     images.localId = [];
			//   	var post=document.getElementById('post');
			//     var str='';
			//     for (var k = length - 1; k >= 0; k--) {
			//     	str+='<input type="hidden" name="media_id[]" value="'+images.serverId[k]+'">'
			//     }
			//     str+='<input type="submit" value="开始下载到本地">';
			//     post.innerHTML=str;
			//   	}
			// 5.2 图片预览
			  document.querySelector('#previewImage').onclick = function () {
			    wx.previewImage({
			      current: 'http://tv.zhbit.com/secondHand/Admin/User/getTicket',
			      urls: images.localId
			     
			    });
			  };
			  //  // 5.4 下载图片
			  // document.querySelector('#downloadImage').onclick = function () {
			  //   if (images.serverId.length === 0) {
			  //     alert('请先使用 uploadImage 上传图片');
			  //     return;
			  //   }
			  //   var i = 0, length = images.serverId.length;
			  //   images.localId = [];
			  //   function download() {
			  //     wx.downloadImage({
			  //       serverId: images.serverId[i],
			  //       success: function (res) {
			  //         i++;
			  //         alert('已下载：' + i + '/' + length);
			  //         images.localId.push(res.localId);
			  //         if (i < length) {
			  //           download();
			  //         }
			  //       }
			  //     });
			  //   }
			  //   download();
			  // };

	// var aa=[];
	// var sid=[];
	// var images = {
	// 			  	localId: [],
	// 			    serverId: []
	// 			  };
	//  function a(){
	//  		var main=document.getElementById('main');
	//  		var a

	// 		wx.chooseImage({
	// 		  count: 1, // 默认9
	// 		  sizeType: ['original'],
	// 		  sourceType: ['album', 'camera'],
	// 		  success: function (res) {
	// 		    var localId= res.localIds[0];
	// 		    $('#localId').text(localId);
	// 		  //选择图片成功，上传到微信服务器
	// 		 wx.uploadImage({
	// 		      localId: localId, // 需要上传的图片的本地ID，由chooseImage接口获得
	// 		      isShowProgressTips: 1, // 默认为1，显示进度提示
	// 		      success: function (res) {
	// 		      	alert("123");
	// 		        var serverId = res.serverId; // 返回图片的服务器端ID
	// 		        $('#serverId').text(serverId);
	// 		      }
	// 		    });
	// 		  }
	// 		});


	// 	    //上传图片
	// 		// wx.uploadImage({

	// 		// 	    localId: '', // 需要上传的图片的本地ID，由chooseImage接口获得
	// 		// 	    isShowProgressTips: 1, // 默认为1，显示进度提示
	// 		// 	    success: function (res) {
	// 		// 	        var serverId = res.serverId; // 返回图片的服务器端ID
	// 		// 	    }

	// 		// });
	// 										      // alert(localId);
	// 		      // alert(serverId);
	// 		     //下载图片
	// 		    // var i = 0, length = images.serverId.length;
	// 		    // images.localId = [];
	// 		    // function download() {
	// 		    //   wx.downloadImage({
	// 		    //     serverId: images.serverId[i],
	// 		    //     success: function (res) {
	// 		    //       i++;
	// 		    //       alert('已下载：' + i + '/' + length);
	// 		    //       images.localId.push(res.localId);
	// 		    //       if (i < length) {
	// 		    //         download();
	// 		    //       }
	// 		    //     }
	// 		    //   });
	// 		    // }
	// 		    // download();
 //    }
 //    		function d(){
 //    			alert(images.localId);
 //    			wx.uploadImage({

	// 			    localId:images.localId, // 需要上传的图片的本地ID，由chooseImage接口获得
	// 			    isShowProgressTips: 1, // 默认为1，显示进度提示
	// 			    success: function (res) {
	// 			        var serverId = res.serverId; // 返回图片的服务器端ID
	// 			    }

	// 		});
	// 			// var i = 0, length = images.localId.length;
	// 		 //    images.serverId = [];
	// 		 //    function upload() {
	// 		 //      wx.uploadImage({
	// 		 //        localId: images.localId[i],
	// 		 //        success: function (res) {
	// 		 //          i++;
	// 		 //          alert('已上传：' + i + '/' + length);
	// 		 //          images.serverId.push(res.serverId);
	// 		 //          if (i < length) {
	// 		 //            upload();
	// 		 //          }
	// 		 //        },
	// 		 //        fail: function (res) {
	// 		 //          alert(JSON.stringify(res));
	// 		 //        }
	// 		 //      });
	// 		 //    }
	// 		 //    upload();
 //    		}
 //    		function c(){
 //    			 //alert(aa[0]);
			    
 //    			// wx.previewImage({
	// 		    //   current: a[0],
	// 		    //   urls: aa
 //   				//  });
 //    		}
</script>
</html>